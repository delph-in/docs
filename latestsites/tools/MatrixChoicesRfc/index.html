<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>DELPH-IN</title>
<meta name="description" content="DELPH-IN Documentation">


  <meta name="author" content="DELPH-IN">
  


<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="DELPH-IN">
<meta property="og:title" content="DELPH-IN">
<meta property="og:url" content="https://delph-in.github.io/docs/tools/MatrixChoicesRfc/">


  <meta property="og:description" content="DELPH-IN Documentation">











  

  


<link rel="canonical" href="https://delph-in.github.io/docs/tools/MatrixChoicesRfc/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "DELPH-IN",
      "url": "https://delph-in.github.io/docs/tools/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/docs/tools/feed.xml" type="application/atom+xml" rel="alternate" title="DELPH-IN Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/docs/tools/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--delphin_page wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/docs/tools/"><img src="/docs/tools/assets/images/Delph-In.png" alt="DELPH-IN"></a>
        
        <a class="site-title" href="/docs/tools/">
          DELPH-IN
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="https://delph-in.github.io/docs/home/Home">Home</a>
            </li><li class="masthead__menu-item">
              <a href="https://delph-in.github.io/docs/howto/DelphinWelcome">How-To</a>
            </li><li class="masthead__menu-item">
              <a href="https://delph-in.github.io/docs/erg/ErgTop">ERG</a>
            </li><li class="masthead__menu-item">
              <a href="https://delph-in.github.io/docs/tools/ToolsTop">Tools</a>
            </li><li class="masthead__menu-item">
              <a href="https://delph-in.github.io/docs/grammars/GrammarsOverview">Grammars</a>
            </li><li class="masthead__menu-item">
              <a href="https://delph-in.github.io/docs/matrix/MatrixDocsOverview">Matrix</a>
            </li><li class="masthead__menu-item">
              <a href="https://delph-in.github.io/docs/summits/SummitTop">Summits</a>
            </li><li class="masthead__menu-item">
              <a href="https://delph-in.github.io/docs/garage/GarageTop">Garage</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">Tools</span>
        

        
        <ul>
          
            <li><a href="/docs/tools/ToolsTop/">Overview</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">PyDelphin</span>
        

        
        <ul>
          
            <li><a href="/docs/tools/PyDelphinTop/">Overview</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">LKB</span>
        

        
        <ul>
          
            <li><a href="/docs/tools/LkbTop/">Overview</a></li>
          
            <li><a href="/docs/tools/LkbInstallation/">Installation</a></li>
          
            <li><a href="/docs/tools/LkbFos/">Fully Open Source Version</a></li>
          
            <li><a href="/docs/tools/LkbMacintosh/">Macintosh Version</a></li>
          
            <li><a href="/docs/tools/LkbCourses/">Courses</a></li>
          
            <li><a href="/docs/tools/LkbConventions/">Conventions</a></li>
          
            <li><a href="/docs/tools/LkbGeneration/">Generation</a></li>
          
            <li><a href="/docs/tools/LkbCompilation/">Compilation</a></li>
          
            <li><a href="/docs/tools/LkbEmacs/">Emacs</a></li>
          
            <li><a href="/docs/tools/LkbTrollet/">Trollet</a></li>
          
            <li><a href="/docs/tools/LkbSppp/">Simple PreProcessor Protocol</a></li>
          
            <li><a href="/docs/tools/RmrsVpm/">Variable Property Mapping (VPM)</a></li>
          
            <li><a href="/docs/tools/LkbLpconstraints/">LkbLpconstraints</a></li>
          
            <li><a href="/docs/tools/LkbUserGroup/">User Group</a></li>
          
            <li><a href="/docs/tools/LkbFaq/">FAQ</a></li>
          
            <li><a href="/docs/tools/LkbMode/">Emacs FAQ</a></li>
          
            <li><a href="/docs/tools/LkbWishlist/">Wish list</a></li>
          
            <li><a href="/docs/tools/LkbBugs/">Bugs</a></li>
          
            <li><a href="/docs/tools/LkbCopyright/">Copyright</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">ACE Parser</span>
        

        
        <ul>
          
            <li><a href="/docs/tools/AceTop/">Overview</a></li>
          
            <li><a href="/docs/tools/AceInstall/">Install</a></li>
          
            <li><a href="/docs/tools/AceConfiguration/">Configuration</a></li>
          
            <li><a href="/docs/tools/AceOptions/">Options</a></li>
          
            <li><a href="/docs/tools/AceUse/">Examples</a></li>
          
            <li><a href="/docs/tools/AceLui/">LUI Mode</a></li>
          
            <li><a href="/docs/tools/AceCsaw/">Csaw</a></li>
          
            <li><a href="/docs/tools/AceTransfer/">Transfer</a></li>
          
            <li><a href="/docs/tools/AceExperimental/">Experimental</a></li>
          
            <li><a href="/docs/tools/AceFaq/">Faq</a></li>
          
            <li><a href="/docs/tools/AceWishlist/">Wish list</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">LKB LUI</span>
        

        
        <ul>
          
            <li><a href="/docs/tools/LkbLui/">Overview</a></li>
          
            <li><a href="/docs/tools/LuiRc/">User Configuration</a></li>
          
            <li><a href="/docs/tools/LuiUi/">UI Quick Reference</a></li>
          
            <li><a href="/docs/tools/LuiTree/">Tree</a></li>
          
            <li><a href="/docs/tools/LuiAvm/">Feature Structure (AVM)</a></li>
          
            <li><a href="/docs/tools/LuiUnification/">Unification</a></li>
          
            <li><a href="/docs/tools/LuiMrs/">MRS Display</a></li>
          
            <li><a href="/docs/tools/LuiChart/">Chart Browser</a></li>
          
            <li><a href="/docs/tools/LuiWishlist/">Wish list</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">LKB LexDB</span>
        

        
        <ul>
          
            <li><a href="/docs/tools/LexDbSimplePsql/">Simple PSQL</a></li>
          
            <li><a href="/docs/tools/LexDbInitialize/">Initialization</a></li>
          
            <li><a href="/docs/tools/LexDbPsqlInitialize/">PSQL Initialization</a></li>
          
            <li><a href="/docs/tools/LexDbFieldMappings/">Field Mappings</a></li>
          
            <li><a href="/docs/tools/LkbLexDbMultiUser/">Multi-User</a></li>
          
            <li><a href="/docs/tools/LkbLexDbSingleUser/">Single User</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">[incr tsdb()]</span>
        

        
        <ul>
          
            <li><a href="/docs/tools/ItsdbTop/">Overview</a></li>
          
            <li><a href="/docs/tools/TsdbTop/">Deep Dive</a></li>
          
            <li><a href="/docs/tools/ItsdbDerivations/">Derivations</a></li>
          
            <li><a href="/docs/tools/ItsdbProfileManipulation/">Profile Manipulation</a></li>
          
            <li><a href="/docs/tools/ItsdbProfile/">Profile</a></li>
          
            <li><a href="/docs/tools/ItsdbProfiling/">Profiling</a></li>
          
            <li><a href="/docs/tools/ItsdbDistributedProcessing/">Distributed Processing</a></li>
          
            <li><a href="/docs/tools/ItsdbBatch/">Batch</a></li>
          
            <li><a href="/docs/tools/ItsdbReference/">Reference</a></li>
          
            <li><a href="/docs/tools/ItsdbTroubleshooting/">Troubleshooting</a></li>
          
            <li><a href="/docs/tools/GeFaqTsdbRc/">FAQ</a></li>
          
            <li><a href="/docs/tools/ItsdbWishlist/">Wish List</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Logon</span>
        

        
        <ul>
          
            <li><a href="/docs/tools/LogonTop/">Overview</a></li>
          
            <li><a href="/docs/tools/LogonInstallation/">Installation</a></li>
          
            <li><a href="/docs/tools/LogonRedhat/">Red Hat</a></li>
          
            <li><a href="/docs/tools/LogonUbuntu/">Ubuntu</a></li>
          
            <li><a href="/docs/tools/LogonArch/">Arch Linux</a></li>
          
            <li><a href="/docs/tools/LogonDebian/">Debian</a></li>
          
            <li><a href="/docs/tools/LogonHandon/">Hands-On Release</a></li>
          
            <li><a href="/docs/tools/LogonSvn/">SVN</a></li>
          
            <li><a href="/docs/tools/LogonProcessing_BatchGeneration/">Batch Generation</a></li>
          
            <li><a href="/docs/tools/LogonProcessing_BatchTranslation/">Batch Translation</a></li>
          
            <li><a href="/docs/tools/LogonPet/">PET Integration</a></li>
          
            <li><a href="/docs/tools/LogonAnswer/">ACE Integration</a></li>
          
            <li><a href="/docs/tools/LogonExtras/">Extras</a></li>
          
            <li><a href="/docs/tools/LogonReports/">Reports</a></li>
          
            <li><a href="/docs/tools/LogonProcessing/">Processing</a></li>
          
            <li><a href="/docs/tools/LogonProcessing_BatchParsing/">Batch Parsing</a></li>
          
            <li><a href="/docs/tools/LogonModeling/">Modeling</a></li>
          
            <li><a href="/docs/tools/LogonOnline/">Online</a></li>
          
            <li><a href="/docs/tools/LogonTransfer/">Transfer</a></li>
          
            <li><a href="/docs/tools/LogonVpm/">Variable Property Mapping</a></li>
          
            <li><a href="/docs/tools/NoJa/">Setting up New Languages</a></li>
          
            <li><a href="/docs/tools/LogonIdiosyncrasies/">Idiosyncrasies</a></li>
          
            <li><a href="/docs/tools/LogonWishlist/">Wishlist</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Grammar Tips</span>
        

        
        <ul>
          
            <li><a href="/docs/tools/GrammarPerformance/">Grammar Performance</a></li>
          
            <li><a href="/docs/tools/VersionControlForGrammarDevelopment/">Grammar Version Control</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Treebanking</span>
        

        
        <ul>
          
            <li><a href="/docs/tools/TreebankingTop/">Overview</a></li>
          
            <li><a href="/docs/tools/FftbTop/">Full Forest Treebanker (FFTB)</a></li>
          
            <li><a href="/docs/tools/FftbTreebankUpdateTutorial/">FFTB Treebank Update Tutorial</a></li>
          
            <li><a href="/docs/tools/FftbWishlist/">Full Forest Treebanker Wishlist</a></li>
          
            <li><a href="/docs/tools/ItsdbTreebanking/">[incr tsdb()] Treebanking</a></li>
          
            <li><a href="/docs/tools/ItsdbTreebanking_ItsdbAnnotation/">[incr tsdb()] Treebanking Annotation</a></li>
          
            <li><a href="/docs/tools/ItsdbTreebanking_ItsdbUpdating/">[incr tsdb()] Treebanking Updating</a></li>
          
            <li><a href="/docs/tools/ItsdbTreebanking_ItsdbExporting/">[incr tsdb()] Treebanking Exporting</a></li>
          
            <li><a href="/docs/tools/ItsdbTreebanking_ItsdbModeling/">[incr tsdb()] Treebanking Modeling</a></li>
          
            <li><a href="/docs/tools/ItsdbTreebanking_ItsdbUpdating/">[incr tsdb()] Treebanking Updating</a></li>
          
            <li><a href="/docs/tools/ItsdbCustomization/">[incr tsdb()] Treebanking Customization</a></li>
          
            <li><a href="/docs/tools/ItsdbTreebanking_ItsdbModeling/">[incr tsdb()] Treebanking Modeling</a></li>
          
            <li><a href="/docs/tools/IndraTreebanking/">Indra</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Formats</span>
        

        
        <ul>
          
            <li><a href="/docs/tools/DelphinRFCs/">Delphin RFCs</a></li>
          
            <li><a href="/docs/tools/PredicateRfc/">Predicate RFC</a></li>
          
            <li><a href="/docs/tools/MrsRFC/">MRS Format RFC</a></li>
          
            <li><a href="/docs/tools/MrsIsomorphism/">MRS Isomorphism</a></li>
          
            <li><a href="/docs/tools/EdsTop/">EDS Format</a></li>
          
            <li><a href="/docs/tools/EdsConversion/">EDS Conversion</a></li>
          
            <li><a href="/docs/tools/EdsGeneration/">EDS Generation</a></li>
          
            <li><a href="/docs/tools/SemiRfc/">SEM-I RFC</a></li>
          
            <li><a href="/docs/tools/TdlRFC/">TDL RFC</a></li>
          
            <li><a href="/docs/tools/TsqlRfc/">TSQL RFC</a></li>
          
            <li><a href="/docs/tools/GrammarVersionRfc/">Grammar Version RFC</a></li>
          
            <li><a href="/docs/tools/GrammarConfigurationRfc/">Grammar Configuration RFC</a></li>
          
            <li><a href="/docs/tools/TsdbSchemaRfc/">TSDB Schema RFC</a></li>
          
            <li><a href="/docs/tools/MatrixChoicesRfc/" class="active">Matrix Choices RFC</a></li>
          
            <li><a href="/docs/tools/RmrsTop/">(R)MRS Overview</a></li>
          
            <li><a href="/docs/tools/RmrsWellformedness/">(R)MRS Wellformedness</a></li>
          
            <li><a href="/docs/tools/RmrsPos/">(R)MRS Predicate Naming</a></li>
          
            <li><a href="/docs/tools/RmrsSpan/">(R)MRS Span</a></li>
          
            <li><a href="/docs/tools/RmrsDesign/">(R)MRS Design</a></li>
          
            <li><a href="/docs/tools/RmrsParaphrasing/">(R)MRS Paraphrasing</a></li>
          
            <li><a href="/docs/tools/RmrsModel/">(R)MRS Model</a></li>
          
            <li><a href="/docs/tools/RmrsDistributional/">(R)MRS Distributional</a></li>
          
            <li><a href="/docs/tools/RmrsSemi/">(R)MRS Semi</a></li>
          
            <li><a href="/docs/tools/RmrsDmrs/">(R)MRS Dmrs</a></li>
          
            <li><a href="/docs/tools/RmrsFaq/">(R)MRS Faq</a></li>
          
            <li><a href="/docs/tools/RmrsDiscussions/">(R)MRS Discussions</a></li>
          
            <li><a href="/docs/tools/TransferRules/">Transfer Rules</a></li>
          
            <li><a href="/docs/tools/FormatSpecifications/">Format Specifications</a></li>
          
            <li><a href="/docs/tools/ErgGml/">Grammar Markup Language</a></li>
          
            <li><a href="/docs/tools/SmafTop/">SMAF</a></li>
          
            <li><a href="/docs/tools/SmafLkb/">SMAF in LKB</a></li>
          
            <li><a href="/docs/tools/SmafPet/">SMAF in PET</a></li>
          
            <li><a href="/docs/tools/SmafSample/">SMAF Sample</a></li>
          
            <li><a href="/docs/tools/SmafDtd/">SMAF DTD</a></li>
          
            <li><a href="/docs/tools/SafTop/">SAF Overview</a></li>
          
            <li><a href="/docs/tools/SafDtd/">SAF DTD</a></li>
          
            <li><a href="/docs/tools/IconsSpecs/">Icons Specs</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>

    
  
  </div>



  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          


        </header>
      

      <section class="page__content e-content" itemprop="text">
        
        <h2 id="abstract">Abstract</h2>

<p>In this document, we provide an outline for an overhaul of the choices
system for the Grammar Matrix. The primary changes are moving to a
standard serialization format, the introduction of a choices schema, and
the decoupling of choices and questionnaire display (matrixdef). We
propose using <a href="https://github.com/toml-lang/toml">TOML</a> as an open
source, non-proprietary, generally available data storage format. We
propose providing a schema for choices files and an associated API.
These changes will make development easier and help enable connecting
the Grammar Matrix to other projects, both as a component and a target.</p>

<p>See <a href="https://delph-in.github.io/docs/summits/VirtualChoices">VirtualChoices</a> for a discussion on this topic.</p>

<h2 id="introduction">Introduction</h2>

<p>The Grammar Matrix is composed of several components, including but not
limited to the following:</p>

<ol>
  <li>matrix.tdl</li>
  <li>the customization system</li>
  <li>the questionnaire</li>
  <li>the regression tests</li>
</ol>

<p>A choices file is a serialized data file containing both 1) the answers
to questions in the questionnaire (as well as annotated data such as
lexical entries) and 2) information mapping choices to the matrixdef
file that participated in generating it. (2) includes, but is probably
not limited to:</p>

<ul>
  <li>the sections and section names of the matrixdef file</li>
  <li>the choice names and (optionally) valid choices of the matrixdef
file</li>
  <li>the ordering of the above</li>
</ul>

<p>Currently, choices are written in a proprietary storage format (DSL).</p>

<p>The code implementing choices is defined in three locations:</p>

<ul>
  <li>choices.py (the main data structure definitions, API)</li>
  <li>deffile.py (choices deserialization)</li>
  <li>matrix.cgi (choices serialization)</li>
</ul>

<h2 id="motivations">Motivations</h2>

<p>The goals for changing this setup include the following:</p>

<ol>
  <li><strong>Ease of human reading</strong>: the current choices file format is
generally human readable, and this is an important consideration of
any new changes. However, indexing and non-obvious nesting can make
choices difficult for newcomers to understand.</li>
  <li><strong>Ease of human editing</strong>: along with reading, being able to
identify and edit a choice without using the customization system is
a critical requirement, for use with matrix.py, debugging, and
development.</li>
  <li><strong>Ease of creation</strong>: it is currently difficult to write a choices
file from scratch. One must parse the current matrixdef file to
understand available sections, choices, and options. Ideally, one
would be able to write choices with very few dependencies.</li>
  <li><strong>Computer serialization and deserialization</strong>: choices are
currently stored in a proprietary format, so reading and writing
them requires implementing a significant amount of code.</li>
  <li><strong>Make development easier</strong>: currently, changing anything to do with
choices probably requires changes in several locations and is
brittle.</li>
  <li><strong>Choices as a component</strong>: a modularized choices format could be
used as a data format in other projects, targeting the Grammar
Matrix or not.</li>
  <li><strong>Matrix as a target</strong>: modularizing the choices format could help
others develop systems that use the Grammar Matrix (i.e. matrix.py)
without the Customization System (e.g. AGGREGATION).</li>
</ol>

<p>To achieve these goals, we propose the following changes:</p>

<ol>
  <li>Changing the choices serialization format</li>
  <li>Introducing a choices schema</li>
</ol>

<h2 id="background">Background</h2>

<p>The existing choices data serialization consists of the following data
types:</p>

<ol>
  <li>Dictionaries (maps)</li>
  <li>Lists (arrays/vectors)</li>
  <li>Strings / References</li>
  <li>Integers</li>
</ol>

<p>Below is an example snippet of the existing choices format as of July
2020 from the mini English choices file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>section=morphology
  noun-pc1_name=num
  noun-pc1_obligatory=on
  noun-pc1_order=suffix
  noun-pc1_inputs=noun1
    noun-pc1_lrt1_name=singular
      noun-pc1_lrt1_feat1_name=number
      noun-pc1_lrt1_feat1_value=sg
      noun-pc1_lrt1_lri1_inflecting=no
    noun-pc1_lrt2_name=plural
      noun-pc1_lrt2_feat1_name=number
      noun-pc1_lrt2_feat1_value=pl
      noun-pc1_lrt2_lri1_inflecting=yes
      noun-pc1_lrt2_lri1_orth=s
  verb-pc1_name=pernum
  verb-pc1_obligatory=on
  verb-pc1_order=suffix
  verb-pc1_inputs=verb
    verb-pc1_lrt1_name=3sg
      verb-pc1_lrt1_feat1_name=person
      verb-pc1_lrt1_feat1_value=3rd
      verb-pc1_lrt1_feat1_head=subj
      verb-pc1_lrt1_feat2_name=number
      verb-pc1_lrt1_feat2_value=sg
      verb-pc1_lrt1_feat2_head=subj
      verb-pc1_lrt1_lri1_inflecting=yes
      verb-pc1_lrt1_lri1_orth=s
    verb-pc1_lrt2_name=pl
      verb-pc1_lrt2_feat1_name=number
      verb-pc1_lrt2_feat1_value=pl
      verb-pc1_lrt2_feat1_head=subj
      verb-pc1_lrt2_lri1_inflecting=no
    verb-pc1_lrt3_name=non-3rd
      verb-pc1_lrt3_feat1_name=person
      verb-pc1_lrt3_feat1_value=1st, 2nd
      verb-pc1_lrt3_feat1_head=subj
      verb-pc1_lrt3_lri1_inflecting=no
</code></pre></div></div>

<p>These choices are aligned with the matrixdef section named morphology,
and the following matrixdef snippet as of July 2020 (trimmed for
brevity, only including items relevant to choices snippet above):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Section morphology "Morphology"

BeginIter noun-pc{i} "a Position Class" 1 0

  Text name "Noun Position Class {i} Name" "&lt;b&gt;Noun Position Class {i}&lt;/b&gt;:&lt;br/&gt;Position Class Name: " " " 20

  Check obligatory "Noun Position Class {i} Obligatory" "&lt;br/&gt;Obligatorily occurs:" ""

Select order "Noun Position Class {i} Order" "&lt;br/&gt;Appears as a prefix or suffix:" ""
. prefix "Prefix" "prefix"
. suffix "Suffix" "suffix"

  MultiSelect inputs "Noun Position Class {i} Input" "&lt;br/&gt;Possible inputs:" ""
  fillcache c=nouns
  fillregex p=(verb|noun)-pc[0-9]+(_lrt[0-9]+)?_name
  . noun "Any noun" "any noun"

  BeginIter lrt{j} "a Lexical Rule Type" 1 0

    Text name "Noun Position Class {i} Lexical Rule Type {j} Name" "&lt;b&gt;Lexical Rule Type {j}&lt;/b&gt;:&lt;br/&gt;Name: " "" 20
    BeginIter feat{k} "a Feature"

      Select name "Noun Position Class {i} Lexical Rule Type {j} Feature {k} Name" "Name: " " "
      fillnames c=both

      MultiSelect value "Noun Position Class {i} Lexical Rule Type {j} Feature {k} Value" "Value: " ""
      fillvalues p=noun-pc{i}_lrt{j}_feat{k}_name

    EndIter feat

    BeginIter lri{k} "a Lexical Rule Instance" 0 1

      Radio inflecting "Noun Position Class {i} Lexical Rule Type {j} Lexical Rule Instance {k} Has Orthography" "Instance {k}" ""
      . no "No" "" "No affix"
      . yes "Yes" "" "Affix spelled"

      Text orth "Noun Position Class {i} Lexical Rule Type {j} Lexical Rule Instance {k} Spelling" "" "" 20

    EndIter lri

  EndIter lrt

EndIter noun-pc

BeginIter verb-pc{i} "a Position Class" 1

  Text name "Verb Position Class {i} Name" "&lt;b&gt;Verb Position Class {i}&lt;/b&gt;:&lt;br/&gt;Position Class Name: " " " 20

  Check obligatory "Verb Position Class {i} Obligatory" "&lt;br/&gt;Obligatorily occurs:" ""

  Select order "Verb Position Class {i} Order" "&lt;br/&gt;Appears as a prefix or suffix:" ""
  . prefix "Prefix" "prefix"
  . suffix "Suffix" "suffix"

  BeginIter lrt{j} "a Lexical Rule Type" 1 1

    Text name "Verb Position Class {i} Lexical Rule Type {j} Name" "&lt;b&gt;Lexical Rule Type {j}&lt;/b&gt;:&lt;br/&gt;Name: " "" 20

    BeginIter feat{k} "a Feature"

      Select name "Verb Position Class {i} Lexical Rule Type {j} Feature {k} Name" "Name: " " "
      fillnames c=both

      MultiSelect value "Verb Position Class {i} Lexical Rule Type {j} Feature {k} Value" "Value: " ""
      fillvalues p=verb-pc{i}_lrt{j}_feat{k}_name

      Select head "Verb Position Class {i} Lexical Rule Type {j} Feature {k} Head" "Specified on: " ""
      . verb "The verb" "the verb"
      . subj "The subject" "the subject NP"
      . obj "The object" "the object NP"

    EndIter feat

    BeginIter lri{k} "a Lexical Rule Instance" 0 1

      Radio inflecting "Verb Position Class {i} Lexical Rule Type {j} Lexical Rule Instance {k} Has Orthography" "Instance {k}" ""
      . no "No" "" "No affix"
      . yes "Yes" "" "Affix spelled"

      Text orth "Verb Position Class {i} Lexical Rule Type {j} Lexical Rule Instance {k} Spelling" "" "" 20

    EndIter lri

  EndIter lrt

EndIter verb-pc
</code></pre></div></div>

<h2 id="proposals">Proposals</h2>

<h3 id="serialization-format">Serialization Format</h3>

<p>Using a standard serialization format allows the Grammar Matrix code,
other code, and humans to more easily read and write choices files. By
relying on an existing third party implementation, this would also
reduce the amount of code in the Grammar Matrix repo, making development
easier.</p>

<h4 id="serialization-language">Serialization Language</h4>

<p>Several candidates were considered for the serialization format: JSON,
YAML, StrictYAML, and TOML.</p>

<ul>
  <li><a href="https://www.json.org/json-en.html">JSON</a>: generally considered hard
to read, hard to edit, and hard to create.</li>
  <li><a href="https://yaml.org">YAML</a>: YAML has several things going for it
(widely used, easy to read and write, Python-inspired), however, it
also has many problems. It has a lot of unnecessary features (code
execution, multi-documents, lists as keys, etc.), problems with
ambiguity and typing, and has readability problems with large,
highly nested documents.</li>
  <li><a href="https://github.com/crdoconnor/strictyaml">StrictYAML</a>: StrictYAML
is a subset of YAML that removes many features (e.g. code execution)
and fixes many typing and ambiguity problems. However, it is
currently only implemented in Python and still has readability
problems with large, highly nested documents.</li>
  <li><a href="https://github.com/toml-lang/toml">TOML</a>: TOML is a configuration
language that represents maps and arrays, has fairly readable
syntax, has implementations in many languages
(<a href="https://github.com/sdispater/tomlkit">Python</a>,
<a href="https://www.npmjs.com/package/@iarna/toml/v/toml-1.0.0-rc.1">JavaScript</a>,
etc.) and actually uses some of the same syntax as the existing
choices file format (e.g. nested dictionaries via dot notation).</li>
</ul>

<p>We are recommending TOML in large part due to the lack of problems
compared to YAML and its readability over JSON.</p>

<h4 id="serialization-specifics">Serialization Specifics</h4>

<p>On top of the language, there are decisions about how choices are
organized into the choices file:</p>

<ol>
  <li>Lists of Choices</li>
  <li>Nested Choices</li>
</ol>

<h5 id="lists-of-choices">Lists of Choices</h5>

<p>As of writing, choices are stored as lists using indexing, e.g.:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>section=lexicon
  noun1_det=imp
    noun1_stem1_orth=n1
    noun1_stem1_pred=_n1_n_rel
  noun2_det=imp
    noun2_stem1_orth=n2
    noun2_stem1_pred=_n2_n_rel
</code></pre></div></div>

<p>noun1 is the first noun object as defined by this matrixdef’s
BeginIter noun, which also contains the nested definition BeginIter stem
leading to the object noun1_stem1, which has two choices: orth and
pred.</p>

<p>In TOML, these could be represented in a couple different ways.</p>

<p>The first way would be without explicit indexing, using the existing
mixed map and list nesting:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[lexicon]
  [[lexicon.noun]]
  det = "imp"

    [[lexicon.noun.stem]]
    orth = "n1"
    pred = "_n1_n_rel"

  [[lexicon.noun]]
  det = "imp"

    [[lexicon.noun.stem]]
    orth = "n2"
    pred = "_n2_n_rel"
</code></pre></div></div>

<p>Another proposal is to keep the indexing and store everything in
maps/dictionaries:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[lexicon]
  [lexicon.noun1]
  det = "imp"

    [lexicon.noun1.stem]
    orth = "n1"
    pred = "_n1_n_rel"

  [lexicon.noun2]
  det = "imp"

    [lexicon.noun2.stem]
    orth = "n1"
    pred = "_n2_n_rel"
</code></pre></div></div>

<p>Some considered pros and cons of each approach:</p>

<ul>
  <li>Lists
    <ul>
      <li>Pros
        <ul>
          <li>No worry about indexing collision</li>
          <li>Storing unordered values as unindexed values seems
reasonable</li>
          <li>Closely aligned with the existing format</li>
          <li>Better one-to-one mapping of TOML syntax to matrixdef
syntax.</li>
        </ul>
      </li>
      <li>Cons
        <ul>
          <li>Inserting/deleting entries breaks references</li>
          <li>Sorting/changing order of lists is trivial, but will break
references</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Maps
    <ul>
      <li>Pros
        <ul>
          <li>Inserting/deleting entries is easy (if skipping indices
continues to be acceptable)</li>
          <li>Indexed keys are similar to existing format</li>
          <li>Nested maps may be seen as a simpler/more consistent data
structure</li>
          <li>Arbitrary indexing may make for easier changes and reference
updates (e.g. noun5 could be programmatically replaced with
noun42)</li>
        </ul>
      </li>
      <li>Cons
        <ul>
          <li>Manually editing can cause key collisions</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>As of July 2020, lists of references are stored as comma delimited
strings. In TOML, they would be stored as lists.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># July 2020
noun-pc1_inputs=noun1,noun2

# TOML
[[morphology.noun-pc]]
inputs = ["noun1", "noun2"]
</code></pre></div></div>

<h5 id="nested-choices">Nested choices</h5>

<p>As of writing, choices are nested using chained keys with _ delimiters,
e.g. noun1_stem1_orth is the value for orth of the first stem of the
first noun.</p>

<p>In TOML, these nested choices would be explicitly nested as nested
dictionaries/maps, which uses a similar notation:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># July 2020
section=lexicon
  noun1_det=imp
    noun1_stem1_orth=n1
    noun1_stem1_pred=_n1_n_rel

# TOML
[lexicon.noun1]
det = "imp"

  [lexicon.noun1.stem]
  orth = "n1"
  pred = "_n1_n_rel"
</code></pre></div></div>

<h4 id="serialized-example">Serialized Example</h4>

<p>The following is an example TOML serialization of the example choices
from the background section above, following the <em>Maps</em> proposal above.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[morphology.noun-pc1]
inputs = ["noun1"]
name = "num"
obligatory = "on"
order = "suffix"

  [morphology.noun-pc1.lrt1]
  name = "singular"
    [morphology.noun-pc1.lrt1.feat1]
    name = "number"
    value = ["sg"]

    [morphology.noun-pc1.lrt1.lri1]
    inflecting = "no"

  [morphology.noun-pc1.lrt2]
  name = "plural"
    [morphology.noun-pc1.lrt2.feat1]
    name = "number"
    value = ["pl"]

    [morphology.noun-pc1.lrt2.lri1]
    inflecting = "yes"
    orth = "s"

[morphology.verb-pc1]
inputs = ["verb"]
name = "pernum"
obligatory = "on"
order = "suffix"

  [morphology.verb-pc1.lrt1]
  name = "3sg"
    [morphology.verb-pc1.lrt1.feat1]
    head = "subj"
    name = "person"
    value = ["3rd"]

    [morphology.verb-pc1.lrt1.feat2]
    head = "subj"
    name = "number"
    value = ["sg"]

    [morphology.verb-pc1.lrt1.lri1]
    inflecting = "yes"
    orth = "s"

  [morphology.verb-pc1.lrt2]
  name = "pl"
    [morphology.verb-pc1.lrt2.feat1]
    head = "subj"
    name = "number"
    value = ["pl"]

    [morphology.verb-pc1.lrt2.lri1]
    inflecting = "no"

  [morphology.verb-pc1.lrt3]
  name = "non-3rd"
    [morphology.verb-pc1.lrt3.feat1]
    head = "subj"
    name = "person"
    value = ["1st", "2nd"]

    [morphology.verb-pc1.lrt3.lri1]
    inflecting = "no"
</code></pre></div></div>

<h3 id="choices-schema">Choices Schema</h3>

<p>Currently, a schema for choices is defined in matrixdef. Separating this
schema away from the questionnaire information of matrixdef allows the
Grammar Matrix code, other code, and humans to more easily read and
write choices files. It also better enables other systems to target the
Grammar Matrix.</p>

<p>This proposal has two parts:</p>

<ol>
  <li>Decoupling choices and questionnaire content</li>
  <li>An API for validating schemas, choices files, and matrixdef files.</li>
</ol>

<p>Currently, reading and writing choices files has these dependencies:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>matrix.cgi (used choices, serialization code)
├── deffile.py (deserialization code)
│   └── matrixdef (section definitions, choice definitions)
└── choices.py (data structures)
</code></pre></div></div>

<p>A choices schema would store all of the required information about a
given choices version in one place such that the choices code
dependencies would be much simpler:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>choices.py (data structures, schema (section definitions, choice definitions))
├── tomlkit 3rd party dependency (serialization code, deserialization code)
└── schema 3rd party dependency (schema parsing, validation)
</code></pre></div></div>

<h4 id="decoupling-choices-and-questionnaire-content">Decoupling Choices and Questionnaire Content</h4>

<p>Introducing a schema definition means that the matrixdef file is no
longer the source of truth for the choice definitions, but this is okay
as much of the content of the matrixdef file is actually view definition
that is interpreted into HTML and <a href="/JavaScript">JavaScript</a> for
producing the questionnaire. New choices could be added to the schema
and then automatically imported into the questionnaire. Doing this
allows other programs to read the choices schema without a dependency on
matrixdef or its custom syntax, making the goal of targeting the Matrix
much easier. This also eases later modularization of the choices
component of the Grammar Matrix project, leaving the Definition File
logic in place.</p>

<p>As an example of the current issue with using choices in other projects,
the AGGREGATION code has a divergent copies of
<a href="https://git.ling.washington.edu/agg/aggregation/-/blob/master/src/aggutils/ChoicesReader.py">ChoicesDict</a>,
<a href="https://git.ling.washington.edu/agg/aggregation/-/blob/master/src/aggutils/deffile.py">deffile.py</a>,
and
<a href="https://git.ling.washington.edu/agg/aggregation/-/blob/master/src/aggutils/matrixdef">matrixdef</a>
in order to read and write choices files. Moving to a decoupled choices
format will allow for a single shared dependency.</p>

<h4 id="schema-definition">Schema Definition</h4>

<p>The schema definition is similar to the existing matrixdef file, but
would not not store view information, but only name and type
information. To write and validate the schema, we propose using the
<a href="https://pypi.org/project/schema/">schema</a> project. The schema is
written in Python, such as the following example schema for the
morphology section of matrixdef above (which is not production ready):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from schema import Schema, And, Or, Regex

withIndex = lambda expected: Regex(rf"^{expected}\d+$")
Value = And(str, len)
yes_no = Or('yes', 'no')
on_off = Or('on', 'off')
orders = Or('prefix', 'suffix')

lri = {
  'inflecting': yes_no,
  Optional('orth'): Value
}

schema = Schema({'morphology':
  {withIndex('noun-pc'):
    {'name': Value,
     'obligatory': on_off,
     'order': orders,
     'inputs': [Value], # References to nominal lexical types or lexical rules
      withIndex('lrt'): {'name': Value,
                         withIndex('feat'): {'name': Value,
                                             'value': [Value]},
                         withIndex('lri'): lri}},
   withIndex('verb-pc'): 
    {'name': Value,
     'obligatory': on_off,
     'order': orders,
     'inputs': [Value],
     withIndex('lrt'): {'name': Value,
                        withIndex('feat'): {'name': Value,
                                            'value': [Value],
                                            'head': Or("verb", "subj", "obj"),},
                        withIndex('lri'): lri}}
  }})
</code></pre></div></div>

<p>Some notes:</p>

<ul>
  <li>Iterables can be handled with something similar to the above
withIndex function, though more robust.</li>
  <li>References are stored as strings, and subsequently are typed in the
schema as strings.</li>
  <li>Sections are stored in the schema.</li>
</ul>

<p>The structure generally map to types/functionality in matrixdef:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Top level keys =&gt; Section
withIndex keys =&gt; (Begin|End)Iter
Value =&gt; Text|TextArea|fillcache
[Value] =&gt; MultiSelect
bool =&gt; Check
Or("a", "b") =&gt; Select|Radio
</code></pre></div></div>

<p>Alternatively, the schema could be defined in a TOML structure mirroring
the choices file itself. This would allow for schemas to be
language-neutral, helping facilitate the reading and writing of choices
in other programming languages. For instance, the morphology choices as
shown above could be stored in the following schema:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[morphology]
[[morphology.noun-pc_i]]
name = "str"
obligatory = "bool"
order = ["prefix", "suffix"]
inputs = ["str"] # References to nominal lexical types or lexical rules
  [[morphology.noun-pc_i.lrt_j]]
  name = "str"
    [[morphology.noun-pc_i.lrt_j.feat_k]]
    name = "str"
    value = ["str"]
    [[morphology.noun-pc_i.lrt_j.lri_k]]
    inflecting = ["no", "yes"]
    orth = "str"
[[morphology.verb-pc_i]]
name = "str"
obligatory = "bool"
order = ["prefix", "suffix"]
  [[morphology.verb-pc_i.lrt_j]]
  name = "str"
    [[morphology.verb-pc_i.lrt_j.feat_k]]
    name = "str"
    value = ["str"]
    # the 'head' choice specifies where the feat's value should be constrained
    head = ["verb", "subj", "obj"]
    [[morphology.verb-pc_i.lrt_j.lri_k]]
    inflecting = ["no", "yes"]
    orth = "str"
</code></pre></div></div>

<h4 id="an-choices-schema-api">An Choices Schema API</h4>

<p>Given a choices schema, one would want to do several things with it.
This is a preliminary list:</p>

<ul>
  <li>Walk schema tree</li>
  <li>Validate the schema is valid (valid structure, no repeat names,
valid indexing)</li>
  <li>Validate a given choices file (or ChoicesFile object)</li>
  <li>Validate a given matrixdef file (or MatrixDefFile object)</li>
  <li>Generate an “empty” choices file</li>
  <li>Generate an “empty” matrixdef file</li>
  <li>Add new choices to an existing matrixdef file</li>
  <li>Coerce/sort a given choices file</li>
  <li>Coerce/sort a given matrixdef file</li>
</ul>

<h1 id="meta">Meta</h1>

<p>Date: July 2020 Contributers: T.J. Trimble, Chris Curtis, Michael
Goodman, Olga Zamaraeva</p>

<p>Last update: 2020-07-14 by TJTrimble [<a href="https://github.com/delph-in/docs/wiki/MatrixChoicesRfc/_edit">edit</a>]</p>

        
      </section>

      <footer class="page__meta">
        
        


        


      </footer>

      

      
    </div>

    
  </article>

  
  
</div>

<!--Scroll the navbar to the current page-->
<script type="text/javascript">
  let el = document.querySelector('.nav__list .active');
  if(el){
    el.scrollIntoView({block: "center", inline: "start"});
  }
</script>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    
      <li><a href="/docs/tools/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 DELPH-IN. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/docs/tools/assets/js/main.min.js"></script>




<script src="/docs/tools/assets/js/lunr/lunr.min.js"></script>
<script src="/docs/tools/assets/js/lunr/lunr-store.js"></script>
<script src="/docs/tools/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
